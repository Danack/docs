<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Granular config - because we don't just have dev and prod</title>

        <meta name="description" content="Danack talking about interface segregation">
        <meta name="author" content="Dan Ackroyd">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="css/reveal.css">
        <!-- link rel="stylesheet" href="css/theme/black.css" id="theme" -->
        <link rel="stylesheet" href="css/theme/whiteDanack.css" id="themecss">
        <!-- <link rel="stylesheet" href="lib/css/vsdanack.css" id="codeststylecss"> -->
        <link rel="stylesheet" href="lib/css/zenburn_backup.css" id="codeststylecss">
      
        <style type="text/css">
        /* overrides */
        

        body {
            background: #a8fcfc;
            /* background: -moz-radial-gradient(center, circle cover, #ffffff 0%, #1f1f1f 100%);
            background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%, #555a5f), color-stop(100%, #1f1f1f));*/
            background: -webkit-radial-gradient(center, circle cover, #f2f3ff 45%, rgba(36, 133, 245, 0.21) 75%);
            /* background: -o-radial-gradient(center, circle cover, #ffffff 0%, #efefef 100%);
            background: -ms-radial-gradient(center, circle cover, #ffffff 0%, #efefef 100%); */
            /* background: radial-gradient(center, circle cover, #ffffff 0%, #7f7f7f 100%); */
            /*background-color: #fdfdfd; */
        }
        .reveal section img {
            border: 0;
            background: none;
            box-shadow: 0 0 #000;
        }
        .reveal pre {
            width: 90%;
            font-size: 0.68em;
            margin-left: 0px;
            margin-right: auto;
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 20px;
            padding-bottom: 20px;
          
            /* box-shadow: 0px 0px 24px rgba(0, 0, 0, 0.7); */
        }
        
        /* 
        .reveal pre {
          box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3);
        }
        
        */
        
        .preformatted {
          font-family: monospace;
          white-space: pre;
      }

        .spaceTop {
            margin-top: 50px !important;
        }
        .spaceBottom {
            margin-bottom: 50px !important;
        }

        h2, p, section { text-align: left; }
        .reveal .slides {text-align: left; }
        
        
        h1, h2, h3, h4, h5 {
            font-family: "Quicksand", sans-serif !important;
            font-weight: 200 !important;
            /*text-transform: uppercase; */
        }
        .emhugen { 
            font-size: 1.6em !important;  
        }
            
        .embiggen { 
            font-size: 1.2em !important;  
        }
        .emlargen {
            font-size: 1.05em !important;
        }
        
        .emnormal {
          font-size: 0.9em !important;
        }
        
        .emsmallen { 
            font-size: 0.8em !important;  
        }
        .em_075 {
          font-size: 0.75em !important;
        }
        .em_08 {
          font-size: 0.8em !important;
        }
        .em_085 {
          font-size: 0.9em !important;
        }
        .em_09 {
          font-size: 0.9em !important;
        }
        .em_095 {
          font-size: 0.95em !important;
        }
        .em1 {
          font-size: 1.0em !important;  
        }
        .em1_1 {
          font-size: 1.1em !important;  
        }
        
        .em1_05 {
          font-size: 1.05em !important;  
        }
        .em1_1 {
          font-size: 1.1em !important;  
        }
        .em1_5 {
          font-size: 1.5em !important;  
        }
        .em1_2 {
          font-size: 1.2em !important;  
        }
        .em1_3 {
          font-size: 1.3em !important;  
        }
        .em1_4 {
          font-size: 1.4em !important;  
        }
        
         .em1_8 {
           font-size: 1.8em !important;
         }
        
        .em2 {
          font-size: 2em !important;  
        }
        th {
          font-size: 1.5em !important;
        }
        
        .finale {
            font-size: 192px !important; 
            text-align: center !important;
            /* margin-bottom: 148px !important; */
        }
        .speaker-controls-notes > ul, 
        .speaker-controls-notes ul, 
        .notes > ul,
        .notes  ul{
          margin-top: 0px;
          margin-bottom: 0px;
        }
        
        .centre {
            text-align: center !important;
        }
        
        .subtle {
            color: #7c7c7c;
        }
        
        .smallText {
            font-size: 24px !important;
        }
        
        blockquote {
            background-color: #f5f5f5;
        }
        
        blockquote {
            width: 90% !important;
            /* font-size: 36px !important; */
        }
            
        pre, .danackCode {
            font-size: 26px;
        }

        .rotate {
            /* Safari */
            -webkit-transform: rotate(-90deg);
            
            /* Firefox */
            -moz-transform: rotate(-90deg);
            
            /* IE */
            -ms-transform: rotate(-90deg);
            
            /* Opera */
            -o-transform: rotate(-90deg);
            
            /* Internet Explorer */
            filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
        }
        
        </style>

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>
        <script src="./plugin/jquery/jquery.min.js"></script>
    </head>

    <body>
      <div class="reveal">
        <div class="slides">

<!-- *************************** -->
<section class="em1_4">
    <h1>Granular config</h1>
    <p>
      Because we don't just have dev and prod.
    </p>
    <p>
        <a href="http://twitter.com/MrDanack">@MrDanack</a>
    </p>
  
    <p class="subtle" style="padding-top: 100px">
      <small>Press 'c' to toggle code style</small><br/>
      <small>Press 's' for speaker notes</small>
    </p>

  
</section>

          
<!-- *************************** -->
<section>
  <h1>
   In the beginning, there was dev
  </h1>

  
  <pre class="danackCode spaceTop embiggen" data-trim><code class="php">
$dev = [
    
];

</code>
</pre>
  
  
  <aside class="notes">
    <ul>
      <li>
        I'm going to tell you a story. It's a story that most people should recognise.
      </li>
      <li>
        In the beginning, there was just dev and we only needed one config.
      </li>
      <li>
         This was the last time we were truly happy.
      </li>
    </ul>
  </aside>
</section>



<!-- *************************** -->
<section>
  <h1>
   Oh, you want this code deployed somewhere - dev + live
  </h1>

  <pre class="danackCode spaceTop embiggen" data-trim><code class="php">
$live = [
    
];

</code>
</pre>
  
  <aside class="notes">
    
    <ul>
      <li>
          Well, then we had to put our code live. Which honestly probably wasn't a good idea, but we needed to do it to get paid.
        </li>
      <li>
        So we duplicated the dev environment and changed a few things.
      </li>
      <li>
        And all was good for a while.
      </li>
    </ul>
  </aside>
</section>


<!-- *************************** -->
<section style="width: 100%; text-align: center !important;">
  <img src="/images/Worked-Fine-In-Dev-Ops-Problem-Now.jpg" width="70%" />
  <aside class="notes">
    <ul>
      <li>
   Then after we broke stuff in production, we realised that maybe having a staging environment might be a good idea, and we needed a continuous integration environment for that.
      </li>
    </ul>
  </aside>
</section>


<!-- *************************** -->
<section>
  <h1>
    Stop breaking live pls <br/> dev + staging + live
  </h1>
  
    <pre class="danackCode spaceTop embiggen" data-trim><code class="php">
$staging = [
    
];

</code>
</pre>
  
  <aside class="notes">
    <ul>
      <li>
        So we added a staging environment, by duplicating the live environment and tweaking it a bit.
      </li>
      <li>
        And all was good for a while.
      </li>
    </ul>
  </aside>
</section>




<!-- *************************** -->
<section style="width: 100%; text-align: center !important;">
  <img src="/images/TestAllTheThings.jpg" width="60%" />
  <aside class="notes">
    <ul>
      <li>
        Then we realised that maybe, just maybe running unit-tests might be a good idea.
      </li>
    </ul>
  </aside>
</section>



<!-- *************************** -->
<section>
  <h1>
    Unit tests are a thing - dev + test + staging + live
  </h1>

    <pre class="danackCode spaceTop embiggen" data-trim><code class="php">
$ci = [
    
];

</code>
</pre>

  <aside class="notes">
    <ul>
      <li>
        So we duplicated the staging config settings and tweaked them a bit to add a CI environment.
      </li>
      <li>
        And all was good for a while.
      </li>
    </ul>
  </aside>
</section>





<!-- *************************** -->
<section style="width: 100%; text-align: center !important;">
  <img src="/images/UserDrinkingWater.gif" width="70%" />
  <aside class="notes">
    <ul>
      <li>
        We found out that maybe our users found it difficult to use our site.
      </li>
    </ul>
  </aside>
</section>



<!-- *************************** -->
<section>
  <h1>
    UX people wanted to be able to change stuff
  </h1>
  <p>
    dev + UX + test + staging + live
  </p>

  <aside class="notes">
    <li>
  Then those asshole designers wanted to be able to try out new designs and get feedback from the gottamn users, without having a dev hard-code the changes in the code.</li>
    <li>So we duplicated the dev config block, and changed a few bits.
    </li>
    <li>
        And all was good for a while.
      </li>
  </aside>
</section>

<!-- *************************** -->
<section>
  <h1>
    Remote workers can't access internal services
  </h1>
  <p>
    dev + remote + UX + test + staging + live
  </p>

  <aside class="notes">
    <ul>
      <li>
          And then we realised that if we ever want to allow people to work remotely, where they don't have access to all of the internal services, we need to have a new config block
      </li>
    
      <li>
      So we duplicated the dev config block again.
      </li>
      <li>
        And all was good for a while.
      </li>
    </ul>

  </aside>
</section>
          
          


<!-- *************************** -->
<section>
  <h1>
    Deploying to different host
  </h1>
  <p>
    dev + remote + UX + test + staging + live_cupboard + live_aws
  </p>

  
  <aside class="notes">
    <ul>
      <li>
    And then we has a customer that didn't want us to run the software on hardware that was in a cupboard in the office, and instead they wanted us to deploy it to AWS
      </li>
      <li>
        So we duplicated the live environment and modified a few bits of config.
      </li>
      <li>
        ?And all was good for a while?
      </li>
      
    </ul>
  </aside>
</section>
          
          


<!-- *************************** -->
<section>
  <h1>
    Seven different configs. All unique.
  </h1> 

  <p class="centre" style="font-size: 192px; width: 100%; margin-top: 40px">
     \o/
  </p>

  <aside class="notes">
    <ul>
      <li>
        So we've got seven different configs all of them different.
      </li>
      <li>
        Is this actually good?
      </li>
    </ul>
  </aside>
</section>
         


<!-- *************************** -->
<section>
  <h1>
    Seven different configs. All unique.
  </h1> 

  <p class="centre" style="font-size: 192px; width: 100%; margin-top: 40px">
     <b>ิพ_ิพ</b>
  </p>

  <aside class="notes">
    This is not so good.
  </aside>
</section>
         
<!-- *************************** -->
<section class="emhugen">
  <h1>
    Problems
  </h1>

  <ul>
    <li class="fragment">Need to change settings in multiple places.</li>
    <li class="fragment">No record of whether changes are deliberate or not.</li>
    <li class="fragment">Can't see easily how one environment is different to another.</li>
    <li class="fragment">Setting up a new environment is non-trivial.</li>
  </ul>


  <aside class="notes" >
    <ul style="font-size: 0.7em !important">
      <li>
      Need to change settings in multiple places. This leads to people forgetting to edit stuff that should be changed.
    </li>

    <li>
     If I show you these two config blocks, it's not possible to know whether this is a deliberate difference or whether it's a case of someone forgetting to update it.
    </li>
      
      <li>Can't determine easily what an environment is trying to achieve, without comparing it to other environments.</li>
    
    <li>In real apps where there are 20 or 30 things that need configuring, just setting up a new app environment becomes a burden, as you need to figure out what envs to copy.If something is difficult to do, people will avoid doing...."Do you really need a UX testing environment, can't you just hack the code to do what you want?"
  </li>
    </ul>
  </aside>
</section>

<!-- *************************** -->
<section  class="emhugen">
  <h1>Solution - granular config blocks</h1>
  <p>
    Shameless self-promotion alert
  </p>
  <p>
    github.com/danack/configurator
  </p>

  <aside class="notes">
    <ul>
      <li>The idea is simple - instead of having all the config stored in each environment, break it up into chunks.</li>
      <li>Each chunk has a clear semantic meaning.</li>
      <li>And then allow people to combine them however they want</li>
      <li>My library is really quite shite - the idea is more important than the implmentation.</li>
    </ul>
  </aside>
</section>



<!-- *************************** -->
<section style="width: 100%; text-align: center !important;">
  <img src="/images/PHPYouHaveHeardOfMe.jpg" width="65%" />
  <aside class="notes">
  </aside>
</section>



<!-- *************************** -->
<section>
  
  <h2>Default block gets applied to everything</h2>
  
<pre class="danackCode spaceTop emlargen" data-trim><code class="php">
$default = [
    
];
</code>
</pre>

  <aside class="notes">
    * Shitty example in PHP - I use code for config....the syntax should be obvious,
    * Default settings get used......by default
  </aside>
</section>



<!-- *************************** -->
<section>
  <h2>
    Each environment sets only the bits it cares about
  </h2>

  <pre class="danackCode spaceTop emlargen" data-trim><code class="php">

$remote = [
    'user.authentication_service' = 'spoof',
];

    
$dev = [
    'assets.caching' = false,
];

$uxtesting = [
    'assets.caching' = true,
];
    
</code>
</pre>

  <aside class="notes">
  </aside>
</section>






<!-- *************************** -->
<section class="emhugen">
  <h1>Magic happens</h1>
  
  <p>
    <br/>
    
  </p>
  
  <ul>
    <li>
     Instead of just choosing "dev"
    </li>
    <li>
      The configurator allows people to say they want the "dev,remote,uxtesting" environment.
    </li>
    <li>
      Which means apply the "dev", "remote", "uxtesting" settings in that order.
    </li>
  </ul>

  <aside class="notes">
    * Solution granular controls. Instead of just having separate environments that are monolithic blocks, instead build the application config out of granular settings.
    * Have "dev", "remote", "uxtesting" settings, which means apply the "dev", "remote", "uxtesting" settings in that order.

  </aside>
</section>
          


<section>
  <h1>
    "dev,remote,uxtesting"
  </h1>

  <pre class="danackCode spaceTop emlargen" data-trim><code class="php">

  $settings = array_merge([], $dev);
  $settings = array_merge($settings, $remote);
  $settings = array_merge($settings, $uxtesting);

  return $settings;

</code>
</pre>

  <aside class="notes">
    AKA the setting are combined in the order that the user chose.
  </aside>
</section>


<!-- *************************** -->
<section class="embiggen">
  <h1>
  Benefits
  </h1>

  <ul>
    <li class="fragment">Most of the time, only need to edit a setting in one place, so less chance to forget.</li>
    <!-- <li class="fragment">All entries are deliberate - no need to set/override things you don't care about.</li> -->
    <li class="fragment">Reading what is special for a particular environment becomes trivial.</li>
    <li class="fragment">Adding a new specific environment becomes trivial.</li>
    <li class="fragment">Can combine configs together for huge number of variation.</li>
  </ul>
  
  
  <aside class="notes">
    <ul style="font-size: 0.7em !important">
      <li>
        Adding a new specific environment becomes trivial. You only need to set the config bit that you want to tweak.
      </li>
      <li>
        When something is set in a specific environment it is now obvious that this was a desired thing. Reading what an environment setting does becomes trivial. This is actually really useful when you just want to remind yourself what setting "uxtesting" actually changes. 
      </li>
      
      <li>  
Editing anything in default or in generic settings gets applied to all configs that use that config. So no need to go round editing the same thing in multiple places.
      </li>

      <li>
Setting up a new environment is always done as "I want it the same as this environment, but with this extra setting." You only need to set the one thing that needs changing and add the name you gave the env to your deploy tool. 
      </li>
    </ul>
  </aside>
</section>
          
          




<!-- *************************** -->
<section>
  <h2>
    Brucie bonus - storing config in code is awesome.
  </h2>

  <pre class="danackCode spaceTop embiggen" data-trim><code class="php" data-trim>
&lt;?php

use AwesomeApp\Config;

$default[
    // This is a class constant - very hard to miespeel
    Config::SCRIPT_VERSION => date('jmyhis'),
    // Oh, also, functions are a thing.

    // Can generate absolute paths
    Config::TEMPLATE_CACHE_DIR => 
            realpath(__DIR__)."/var/cache/template",
];

</code>
</pre>

  <aside class="notes">
    Brucie bonus - storing config in code is awesome. Allows you to do things like this:
    
    <ul>
      <li>Class constants - autocomplete all the things. Any misspelling gets picked up as an error</li>
      
      <li>Can run code. I deploy into a unique directory each time, and needed the absolute path. No need to pass it in or do "funny" config syntax, </li>
      
    </ul>
  </aside>
</section>




<!-- *************************** -->
<section>

  <pre class="danackCode spaceTop emlargen" data-trim><code class="php" data-trim>
&lt;?php
// Using variables....
$siteName = 'awesomeapp.com';

//And string concantenation...ah yissss
$dev = [
  Config::LIBRATO_STATS_NAME => 'dev.'.$siteName
];

$staging = [
  Config::LIBRATO_STATS_NAME => 'staging.'.$siteName
];

$live = [
  Config::LIBRATO_STATS_NAME => 'live.'.$siteName
];
</code>
</pre>
  
  <aside class="notes">
    Brucie bonus - storing config in code is awesome. Allows you to do things like this:

    <ul>
      <li>avoids duplication due to this amazing thing called variables.</li>
    </ul>
  </aside>
</section>



<!-- *************************** -->
<section class="emhugen">
    <h1 class="emhugen finale">Fin</h1>
  
  <p class="centre" style="width: 100%">
    github.com/danack/configurator
  </p>
</section>


<!-- *************************** -->
<section style="width: 100%; text-align: center !important;">
  <img src="/images/true_neutral.jpg" width="70%" />
  <aside class="notes">
  </aside>
</section>

          
<section>
  <h1>Granular config for apps.</h1>
  <p>Gone are the days where the only environments you had are dev and prod. These days you have many more environments and need a way of managing config that scales.</p>

  <p>In this talk, I wibble on about how why you should build your config from granular parts, rather than monolithic blocks, so that you can scale your config to support environments for UX testing, people working remotely, unit-testing, etc etc without going insane.
  </p>
  <aside class="notes">
  </aside>
</section>
          

          
                    
          


<!-- *************************** -->
<section>
    <blockquote cite="http://searchservervirtualization.techtarget.com/definition/Our-Favorite-Technology-Quotations">
        &ldquo;For years there has been a theory that millions of monkeys typing at random on millions of typewriters would reproduce the entire works of Shakespeare. The Internet has proven this theory to be untrue.&rdquo;
    </blockquote>
</section>

          
          
          
          
          
      </div>
  </div>

      
      
        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>
            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: false,
                history: true,
                center: true,
                width: 1600,
                height: 900,

                // Factor of the display size that should remain empty around the content
                margin: 0.1,
                slideNumber: true,
                //transition: 'slide', // none/fade/slide/convex/concave/zoom
                transition: 'none', 
                //transitionSpeed: "slow",

                // Optional reveal.js plugins
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    //{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    //{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad({languages: ["php"]}); },  },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });
            
            
            /* This draws the graph on the slide on a slidechanged event */
            Reveal.addEventListener('slidechanged', function(event) {
                var callback = "render_"+event.currentSlide.id;
                if(typeof(window[callback])=="function") {
                    window[callback]();
                }
            } );
            /* This draws the graph if we got here directly without coming from another slide */
            Reveal.addEventListener('ready', function(event) {
                var callback = "render_"+event.currentSlide.id;
                if(typeof(window[callback])=="function") {
                    window[callback]();
                }
            });

var createFunc = function() {
  var counter = 0;
    return function(e) {
      counter = (counter + 1);// % 1;
      
      var themeCSSList = [
        "css/theme/whiteDanack.css",
        "css/theme/beige.css",
        "css/theme/black.css",
        "css/theme/blood.css",
        "css/theme/league.css",
        "css/theme/moon.css",
        "css/theme/night.css",
        "css/theme/serif.css",
        "css/theme/simple.css",
        "css/theme/sky.css",
        "css/theme/solarized.css",
      ];
      
      var codeCSSList = [
        "lib/css/zenburn_backup.css",
        "lib/css/vsdanack.css",
      ];

      if(e.which == 67 || e.which == 99) { //'c'
//        var theme = themeCSSList[counter % themeCSSList.length];
//        $("#themecss").attr('href', theme);

        var codestyle = codeCSSList[counter % codeCSSList.length];
        $("#codeststylecss").attr('href', codestyle);
        $("#debug").text(codestyle);
      }
    };
};

          $(window).keypress(createFunc());
        </script>
    </body>
</html>
