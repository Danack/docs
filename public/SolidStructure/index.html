<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Solid structure</title>

        <meta name="description" content="Danack talking about interface segregation">
        <meta name="author" content="Dan Ackroyd">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

        <link rel="stylesheet" href="css/reveal.css">
        <!-- link rel="stylesheet" href="css/theme/black.css" id="theme" -->
        <link rel="stylesheet" href="css/theme/whiteDanack.css" id="themecss">
        <!-- <link rel="stylesheet" href="lib/css/vsdanack.css" id="codeststylecss"> -->
        <link rel="stylesheet" href="lib/css/zenburn_backup.css" id="codeststylecss">
      
        <style type="text/css">
        /* overrides */
        

        body {
            background: #a8fcfc;
            /* background: -moz-radial-gradient(center, circle cover, #ffffff 0%, #1f1f1f 100%);
            background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%, #555a5f), color-stop(100%, #1f1f1f));*/
            background: -webkit-radial-gradient(center, circle cover, #f2f3ff 45%, rgba(36, 133, 245, 0.21) 75%);
          
          
            /* background: -o-radial-gradient(center, circle cover, #ffffff 0%, #efefef 100%);
            background: -ms-radial-gradient(center, circle cover, #ffffff 0%, #efefef 100%); */
            /* background: radial-gradient(center, circle cover, #ffffff 0%, #7f7f7f 100%); */
            /*background-color: #fdfdfd; */
        }
        .reveal section img {
            border: 0;
            background: none;
            box-shadow: 0 0 #000;
        }
        .reveal pre {
            width: 99%;
            font-size: 0.68em;
            margin-left: 0px;
            margin-right: auto;
            padding-left: 20px;
            padding-right: 20px;
            padding-top: 20px;
            padding-bottom: 20px;
          
            /* box-shadow: 0px 0px 24px rgba(0, 0, 0, 0.7); */
        }
        
        /* 
        .reveal pre {
          box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3);
        }
        
        */
        
        .preformatted {
          font-family: monospace;
          white-space: pre;
      }

        .spaceTop {
            margin-top: 50px !important;
        }
        .spaceBottom {
            margin-bottom: 50px !important;
        }

        h2, p, section { text-align: left; }
        .reveal .slides {text-align: left; }
        
        
        h1, h2, h3, h4, h5 {
            font-family: "Quicksand", sans-serif !important;
            font-weight: 200 !important;
            /*text-transform: uppercase; */
        }
            
        .embiggen { 
            font-size: 1.2em !important;  
        }
        .emlargen {
            font-size: 1.05em !important;
        }
        
        .emnormal {
          font-size: 0.9em !important;
        }
        
        .emsmallen { 
            font-size: 0.8em !important;  
        }
        .em_075 {
          font-size: 0.75em !important;
        }
        .em_08 {
          font-size: 0.8em !important;
        }
        .em_085 {
          font-size: 0.9em !important;
        }
        .em_09 {
          font-size: 0.9em !important;
        }
        .em_095 {
          font-size: 0.95em !important;
        }
        .em1 {
          font-size: 1.0em !important;  
        }
        .em1_1 {
          font-size: 1.1em !important;  
        }
        
        .em1_05 {
          font-size: 1.05em !important;  
        }
        .em1_1 {
          font-size: 1.1em !important;  
        }
        .em1_5 {
          font-size: 1.5em !important;  
        }
        .em1_2 {
          font-size: 1.2em !important;  
        }
        .em1_3 {
          font-size: 1.3em !important;  
        }
        .em1_4 {
          font-size: 1.4em !important;  
        }
        
        .em1_6 {
          font-size: 1.6em !important;  
        }
        .em1_8 {
          font-size: 1.8em !important;  
        }
        
        
        .em2 {
          font-size: 2em !important;  
        }
        
        .em2_4 {
          font-size: 2.4em !important;  
        }
        .em3 {
          font-size: 3em !important;  
        }
        th {
          font-size: 1.5em !important;
        }
        
        .finale {
            font-size: 148px !important; 
            text-align: center !important;
            /* margin-bottom: 148px !important; */
        }
        .speaker-controls-notes > ul, 
        .speaker-controls-notes ul, 
        .notes > ul,
        .notes  ul{
          margin-top: 0px;
          margin-bottom: 0px;
        }
        
        .centre {
            text-align: center !important;
        }
        
        .subtle {
            color: #7c7c7c;
        }
        
        .smallText {
            font-size: 24px !important;
        }
        
        blockquote {
            background-color: #f5f5f5;
        }
        
        blockquote {
            width: 90% !important;
            font-size: 36px !important;
        }
            
        pre, .danackCode {
            font-size: 26px;
        }

        .rotate {
            /* Safari */
            -webkit-transform: rotate(-90deg);
            
            /* Firefox */
            -moz-transform: rotate(-90deg);
            
            /* IE */
            -ms-transform: rotate(-90deg);
            
            /* Opera */
            -o-transform: rotate(-90deg);
            
            /* Internet Explorer */
            filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
        }
        
        </style>

        <!-- Printing and PDF exports -->
        <!-- <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script> -->
        <script src="./plugin/jquery/jquery.min.js"></script>
    </head>

    <body>
      <div class="reveal">
        <div class="slides">

<!-- *************************** -->
<section class="em1_4">
    <h1>Solid structure</h1>
    <h3>Building decoupled applications with an injector.</h3>
    <p>
        <a href="http://twitter.com/MrDanack">@MrDanack</a>
    </p>
    <p class="subtle" style="padding-top: 100px">
      <small>Press 'c' to toggle code style</small><br/>
      <small>Press 's' for speaker notes</small>
    </p>
    <p>
      <a href="https://joind.in/talk/04aa0">https://joind.in/talk/04aa0</a>
    </p>
</section>
          

<section class="em1_4">
  <h1>SOLID principles</h1>

  <table width="100%">
    
  <tr>
    <td>
      Single responsibility
    </td>
    <td>
      <span class="fragment" data-fragment-index="1">★★★★★</span>
    </td>
  </tr>
    
    <tr>
      <td>
        Open/closed
      </td>
      <td>
        <span class="fragment" data-fragment-index="1">wat</span>
      </td>
    </tr>
    
    <tr>
      <td>
        Liskov substitution 
      </td>
      <td>
        <span class="fragment" data-fragment-index="1">★★★★</span>
      </td>
    </tr>
    
    <tr>
      <td>
        Interface segregation 
      </td>
      <td>
        <span class="fragment" data-fragment-index="1">★</span>
      </td>
    </tr>
    
    <tr>
      <td>
        Dependency inversion 
      </td>
      <td>
        <span class="fragment" data-fragment-index="1">★★★</span>
      </td>
    </tr>  
   </table>
  

  
  <p class="fragment" data-fragment-index="1" style="padding-top: 50px">
    If you don't recognise these.....then reading up on them can be your homework.
  </p>

  <aside class="notes">
  <p>
    The title of this talk is a reference to the SOLID principles, which are suggested ways of how to write good code.
  </p>
  </aside>
</section>




          
          

<!-- *************************** -->
<section class="em1_4">
    <h1>Apologies in advance</h1>

    <ul>
      <li>I normally try to make talks start off easy, before reaching the difficult stuff.</li>
      <li>I think I may have failed. </li>
      <li>
        J.B. Rainsberger - Integrated Tests Are A Scam <br/>
        <a href="https://vimeo.com/80533536">https://vimeo.com/80533536</a>
      </li>
    </ul>

    <aside class="notes">
      
      <p>
        I normally try to make talks start off easy, before reaching the difficult stuff.
      </p>
      <p>
        If I completely lose you right from the start, apologies that is my fault. When I was doing a run through yesterday I realised that there's a good chance that the beginning might be a bit confusing, which would make the rest of the talk really hard to follow.
      </p>
      
      <p>
        The ideas in this talk may be easier to understand after watching this talk about integrated tests.
      </p>
      <p>
      </p>
      
    </aside>
</section>


          
<!-- *************************** -->
<section class="em1_5">
  <h1>We'll totally get onto Solid structure....</h1>
  <p>
    ....but first something a bit different.
  </p>
    <aside class="notes">
    <ul>
      <li>
        
      </li>
    </ul>
  </aside>
</section>


<!-- *************************** -->
<section class="em1_4">
    <h1>The true nature of reality</h1>
    <h3>Understanding the most fundamental parts of programming.</h3>
    <p>
        <a href="http://twitter.com/MrDanack">@MrDanack</a>
    </p>
  
    <aside class="notes">
      <p>
          I think people sometimes misunderstand the most fundamental parts of programming. 
      </p>
      <p>
         Who here has studied any quantum physics?
      </p>
    </aside>
</section>



<!-- *************************** -->
<section class="em1_4">
    <h2>So my education background is physics/chemistry</h2>
    
    <ul>
      <li class="fragment">Solids, liquids, gases</li>
      <li class="fragment">Molecules and atoms</li>
      <li class="fragment">Fundamental particles, quarks and leptons</li>
      <li class="fragment">Fundamental forces, gravitational, electromagnetic, strong nuclear, and weak nuclear</li>
    </ul>

  
  <aside class="notes">
    <p>
      At school you learnt about solids liquids and gases.
    </p>
    <p>
      Then at secondary school you learn about molecules and atoms
    </p>
    <p>
      Then at university you start learning about fundamental particles, 
    </p>
    <p>
      And then later years at university you learn about fundamental forces, and how particles don't really exist, And that everything is really just vibrations in a quantum lattice.
    </p>    
   
        
  </aside>
  
</section>




<!-- *************************** -->
<section class="em1_4">
    <h2>So my education background is physics/chemistry</h2>
    
    <ul>
      <li>Solids, liquids, gases</li>
      <li>Molecules and atoms</li>
      <li>Fundamental particles, quarks and leptons</li>
      <li>Fundamental forces, gravitational, electromagnetic, strong nuclear, and weak nuclear</li>
    </ul>
  
  <aside class="notes">

     <p>
       So it's almost 20 years ago to the day, that I was sitting in the lecture hall on a Monday morning at 9am, at the start of a 2 hour lecture about quantum physics, I realised a couple of things:
     </p>

     <p>One - whoever scheduled a 2 hour quantum physics lecture for Monday morning is not a nice person.</p>
      <p>
       Two - quantum physics is a bit hard - perhaps I'll go off and make video games for a living.
     </p>
        
     <p>Three - and most importantly - most of the time, thinking about stuff at a really low level isn't actually that useful. Instead thinking at higher levels of abstraction is a much more productive thing to do.
     </p>

  </aside>
  
</section>



<!-- *************************** -->
<section class="em1_4">
    <h2>Normal ways of thinking about code</h2>
  
  
  <ul>
    <li>
      What language to use
    </li>
    <li>
      Frameworks vs Individual libraries
    </li>
    <li>
        Procedural vs Object oriented
    </li>
    <li>
      Functional vs Stateful
    </li>
  </ul>


  
  <aside class="notes">
    <p>
    </p>
  </aside>
  
</section>



<!-- *************************** -->
<section class="em1_5">
  <h1 class="finale">Those aren't the fundamental aspects of programming</h1>
  
  <p>
    Those aren't the fundamental things.    
  </p>
  <p>
    They're nice, and most of the time they are what you should be thinking about.
    
  </p>
</section>





<section class="em1_4">
    <h2>Fundamental programming forces</h2>
  <table width="100%">
    <tr class="fragment">
      <td align="right">
        Can be unit tested
      </td>
      <td align="center">
        vs
      </td>
      <td>
        Can't be unit tested
      </td>
    </tr>
    <tr class="fragment">
      <td align="right">
        Semantically meaningful types
      </td>
      <td align="center">
        vs
      </td>
      <td>
        Basic types e.g. strings, ints
      </td>
    </tr>
</table>
  
 
    <aside class="notes">
      <p>
      By unit tested, I really mean tested in isolation.
      </p>
      <p>
        This talk is mostly about the difference between unit-testable code and code that can't be tested, but the difference between typed code and 'untyped' code is also important.        
      </p>
      
      <p>
        So left me give you some examples of what the heck I mean.
        
      </p>
  </aside>

</section>




<!-- *************************** -->
<section>
  <img src="/images/SolidStructure_1.png" width="1200px" />
  <aside class="notes">
    
    <p>
      So this is a representation of an application that does something like send notifications to Twitter.
    </p>
      
    <p>
      You have a bootstrap layer, that calls some controller code, that calls some services, which then calls either a database, or some external API that's on the internet.
    </p>
    <p>On the left we have the bootstrap and then index.php</p>
    <p>In the middle we have the actual application code, </p>
    <p>On the right hand side we have code that calls services </p>
  </aside>

</section>



<!-- *************************** -->
<section>
    <h1>Left - bootstrap layer</h1>
  
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
function getTwitterApiKey()
{
    return getenv('twitter_api_key');
}
</code>
</pre>

<pre class="danackCode spaceTop em1 fragment" data-trim><code class="php" data-trim>
// Hard-coded to specific class.
// and so not testable
$app = new App(); 
</code>
</pre>
  
  <aside class="notes">
    <p>
      In the bootstrap layer you have things like this, that read the api key from the environment variable.
    </p>
    <p>
      This is not testable. It relies on the environment variables being set up in particular way. So it is fundamentally not testable in isolation.
    </p>
    <p>
      This true of all config loading no matter how you do it. Wherever the config is stored - even if it's stored as code, it's still just a chunk of data that needs to exit
    </p>
    <p>
      
    </p>
  </aside>
</section>




<!-- *************************** -->
<section>
    <h1>Right - external services</h1>

<ul>
  <li>DB</li>
  <li>External api</li>
  <li>File system</li>
</ul>


  <aside class="notes">
    
    <p>
      Anything that talks to a DB, an external API, or a file system can't be unit-tested.
     </p>
    <p>
      You can test these things - just not with unit-tests. Either regression tests, or integration tests can (and should be) done.
    </p>
    <p>
      But you can't test code that interacts with those things in isolation.
      
    </p>
  </aside>
</section>




<!-- *************************** -->
<section>
    <h1>Right side - is typeless</h1>

<pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
function sendMessageToUser(
    TwitterAPI $twitterApi,
    Message $message,
    User $user
) {
    $text = "@".$user->getName()." ".$message->getText()
    $twitterApi->sendMessage($text);
}
  
class TwitterAPI
{
    function sendMessage(string $text);
    ...
}
  
</code>
</pre>
  
  <aside class="notes">
    <p>
      As I mentioned - Typed vs un-typed is the other fundamental 'force' in programming.....but it's not really the subject of this talk
      
    </p>
    <p>
      You really want to use strong, semantically meaningful types across as much of your application as possible.
    </p>
    <p>
      Pushing semantically weak types to 
    </p>
  </aside>
</section>




<!-- *************************** -->
<section>
    <h1>Middle - your lovely app code</h1>
  

<pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
class SendMessageController
{
    function __construct(TwitterApi $twitter, VariableMap $varMap)
    {
        $message = $varMap->getMessage();
        $twitter->send($message);
    }
}
</code>
</pre>


  
  <aside class="notes">
    <p>
      This can be tested completely. 
    </p>
    
    <p>
      If you push all of the untestable code to the edges, you can write all of your application code in a way that allows it to be completely covered by unit-tests.
    </p>
    <p>
      This is not easy.....if you don't have the right tools
      
    </p>
    
  </aside>
</section>



<!-- *************************** -->
<section>
  <img src="/images/SolidStructure_2.png" width="1200px" />

  <aside class="notes">
    <p>
      On the left, the bootstrap layer is completely untestable.
    </p>
    <p>
      In the middle you have your lovely application code, which you can write unit tests for until you reach 100% coverage.
    </p>
    <p>
      On the right you have external services that can't be unit tested.
      
    </p>
  </aside>

</section>





<!-- *************************** -->
<section>
  <h1>Having two different modes is a problem</h1>
  <ul>
    <li>
      Unstructured - testable + un-testable code gets mixed up, leading to a messy application
    </li>
    
    <li>Encapsulating external services with interfaces can be a bit of pain</li>
  </ul>
  
  <aside class="notes">
    <p></p>
  </aside>

</section>






<!-- *************************** -->
<section>
  <h1>Dependency injection to the rescue</h1>


  <p>
    https://github.com/rdlowrey/auryn
  </p>

  <p>
    Auryn is an auto-wiring recursive dependency injector.
  </p>

  <p class="fragment">
    aka it does DI really well.
  </p>
  
  <aside class="notes">
    <p>
      Dependency injection is awesome.
    </p>
    <p>
      Ever since I started programming, I've always tried to get better each year. However for me a lot of techniques that people say you should follow, are just too painful to use in practice. It turns out, that for a large part it was just because I wasn't using powerful enough tools.
    </p>
    
    <p>
      I think a decent analogy is that trying to write SOLID code without using a Dependency Injection Container, is like trying to do some DIY, but instead of a screwdriver, you use a knife from the kitchen drawer.
    </p>
    <p>
      Theoretically - it could just about work.
      In Practice - it will be just such a pain that you're going to abandon the project half-way through.
    </p>
    <p>
      So......'auto-wiring recursive dependency injector' sounds like a scary phrase. It's not really - I'll break down what Auryn does.
      
    </p>
  </aside>

</section>



<!-- *************************** -->
<section>
    <h1>Auryn runs code for you</h1>
  
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
function foo()
{
  echo 'Hello world';
}

$injector->execute('foo');
// Output is 'Hello world'

</code>
</pre>
  <p>
    Can pass it any callable. 
  </p>
  
  <aside class="notes">
    <p>
      Basically you give it any callable it will run it for you.
    </p>
    <p>
      This is a simple example, that doesn't have any parameters aka dependencies....
    </p>
  </aside>
</section>


<!-- *************************** -->
<section>
    <h2>Defining raw params</h2>
    <pre class="danackCode spaceTop em_09" data-trim><code class="php" data-trim>
      
class FileWriter implements Writer {
    function __construct($path ) { ... }
    function write($string) { ... }
}

$fileWriterParams = array(
    ':path'    => '/var/coolapp',
);

$injector->define('FileWriter', $fileWriterParams);
// Auryn can also just make objects
$fileWriter = $injector->make(FileWriter::class);

</code>
</pre>

  <aside class="notes">
    <p>
      This defines the parameters by name.
    </p>
  </aside>
</section>




<!-- *************************** -->
<section>
    <h2>Auto-wiring means it looks at param types</h2>
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
function writeHelloWorld(FileWriter $fileWriter)
{
     $fileWriter->write("Hello world");
}

$fileWriterParams = array(
    ':path'    => '/var/coolapp',
);

$injector->define('FileWriter', $fileWriterParams);
$injector->execute('writeHelloWorld');
</code>
</pre>
  <p>
    I <3 types. And you should too. 
  </p>
  
  <aside class="notes">
    <p>
      So when there is a parameter that needs to be injected, Auryn goes away makes that parameter, and then passes it to the thing that is being executed.
    </p>
    <p></p>
    <p>
      The biggest problem with a lot of other DI libraries is that they use service names rather than types. This makes setting up the config be a complete nightmare.
    </p>
    <p>
      I wish I'd saved it - there was a bug reported to bugs.php.net where someone had a 15,000 line config file for their Symfony app. And they were wondering why their app was being a bit slow.
    </p>
    <p>
      Auryn just uses types, which means that it automatically understands what your types are, without having to setup 15,000 line config files or using abominations like annotations.
    </p>
  </aside>
</section>






<!-- *************************** -->
<section>
    <h2>Sharing is caring - aka </h2>
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
function writeHelloWorld(FileWriter $fileWriter)
{
     $fileWriter->write("Hello world");
}

$fileWriterParams = array(
    ':path'    => '/var/coolapp',
);

$injector->define('FileWriter', $fileWriterParams);

$injector->share(FileWriter::class); // This line is new
$injector->execute('writeHelloWorld'); // FileWriter is created
$injector->execute('writeHelloWorld'); // FileWriter is reused
</code>
</pre>
  <p>
    
  </p>
  
  <aside class="notes">
    <p>
      For some objects you only ever want to have one of them. For this example we only ever want to have one filewriter.
    </p>
    <p>
      So we tell Auryn to share it as a dependency across all objects that need a file writer. 
    </p>
    <p>
      So the first time we execute writeHelloWorld a FileWriter is created, but then after that, the first object is re-used.

    </p>
  </aside>
</section>




<!-- *************************** -->
<section>
    <h2>You can also share objects</h2>
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>

$object = new Foo();
      
// Fiddle with $object state here

$injector->share($object); // This line is new

</code>
</pre>
  <p>
    
  </p>
  
  <aside class="notes">
    <p>
      Also, instead of telling Auryn to share an object after it's been created, you can just tell Auryn "Here is an object". If you ever need to use an object of that type, use this one.
    </p>
    <p>
      It's really useful when you need to hack around some legacy code that is doing some horrible stuff to initialize objects.
    </p>

  </aside>
</section>






<!-- *************************** -->
<section>
  <h1>Aliasing interfaces to classes</h1>

<pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
class StubWriter implements Writer {
    function write(string $string) {  ... } 
}
  
function foo(Writer $fw)
{
    $fw->write("foo did something");
}

$injector->alias('Writer', 'StubWriter');
$injector->execute('foo');
</code>
</pre>
  
  <aside class="notes">
    <p>Aliasing an interface to a class allows you to say which specific implementation gets created.</p>
    <p>
      In this example, I'm aliasing the interface 'writer' to an implementation, 'StubWriter' - so that when Auryn sees that the function has a dependency on a 'writer' it actually creates a 'StubWriter' instead.
    </p>
  </aside>
  
</section>






<!-- *************************** -->
<section>
    <h1>So far, so 'meh'</h1>
  
    <p>
      Most DICs can do that sort of thing.
    </p>
  <p>
    The key thing that makes Auryn be incredibly powerful is how it allows you to set delegate functions for creating objects, and all of the object instantiation is done recursively.
  </p>

  <aside class="notes">
  </aside>
</section>






<!-- *************************** -->
<section>
    <h1>Delegation is awesome</h1>
  
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>

function createTwitterApiConfig()
{
    return new TwitterApiConfig(
        getenv('twitter_api_key'),
        getenv('twitter_timout'),
    );
}

$injector->delegate('TwitterApiConfig', 'createTwitterApiConfig');
</code>
</pre>

  <aside class="notes">
    <p>
      Auryn allows you to setup delegate functions. These are 
    </p>
  </aside>
</section>



    
<!-- *************************** -->
<section>
    <h1>Recursion is awesome</h1>
  
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>

class TwitterApi {
    function __construct(TwitterApiConfig $tac)
    {
       ...
    }
}

function sendMessage(TwitterApi $twitterApi)
{
    ...
}
      
$injector->delegate('TwitterApiConfig', 'createTwitterApiConfig');
$injector->execute('sendMessage');
</code>
</pre>

  <aside class="notes">
    <p>
      Auryn resolves dependencies recursively. In this example, it goes to execute 'sendMessage', sees that it has a dependency on TwitterApi, so goes off to make that.
    </p>
    <p>
      Auryn then sees that TwitterApi has a dependency on TwitterApiConfig, so goes off to create that, before being able to create the TwitterApi object.
    </p>
    <p>
      The recursion is cool as it means that you don't need to composite anything together yourself. You just tell Auryn how to create each fundamental object once, and it then does the hard work of putting stuff together for you.
    </p>
  </aside>
</section>
    
    

<!-- *************************** -->
<section>
  <h1>End result of using DI</h1>

  <ul>
    <li>
       Testable + typed that makes up most of your app, can be written cleanly.
    </li>
    <li>
     Non-testable + untyped bootstrap code, completely separated away.
    </li>
    <li>
       Injector provides the binding between these two different regions.
    </li>
  </ul>
  
  <aside class="notes">
    <p>I have been using this pattern for a couple of years....I thought it was going to be really easy to explain how awesome it is.</p>
    <p>
      Although I hope I've explained what it does, it's only when you actually start coding like this, you really get to see how powerful it is.
    </p>
    <p>
      Bootstrapping your application becomes really easy. Writing application code in a way that easily testable becomes much easier.
    </p>
  </aside>
  
</section>




<!-- *************************** -->
<section>
  <h1>Limitations of using an injector</h1>

  <p>
    There's two problems that don't occur in 'normal' programming, when using an injector:
  </p>
  
  <ul>
    <li>
       More than one of a type.
    </li>
    <li>
       Unknowable dependencies.
    </li>
  </ul>
  
  <aside class="notes">
    <p></p>
  </aside>
  
</section>




<!-- *************************** -->
<section>
  <h1>More than one of a type</h1>
    <pre class="danackCode spaceTop em1_2" data-trim><code class="php" data-trim>
// Move data that is more than 24 months old to archive
function archiveData(PDO $live, PDO $archive) 
{
    // ...
}

  </code>
</pre>

  
  <aside class="notes">
    <p>
      So we've got some code, that moves data from the live DB to an archive database.
    </p>
    <p>
      Injector can't tell the two parameters apart.
    </p>
  </aside>

</section>

<!-- *************************** -->
<section>
  
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
// Don't execute this directly
function archiveData(PDO $live, PDO $archive) 
{
    // ...
}

// Instead excute a wrapped version.
function archiveDataWrapped(PDOFactory $pdoFactory) 
{
    $live = $pdoFactory->create('live');
    $archive = $pdoFactory->create('archive');
    
    archiveData($live, $archive);
}
  </code>
</pre>

  
  <aside class="notes">
    <p>
      Simplest way to work around this, is to wrap the code.
    </p>

  </aside>

</section>




<!-- *************************** -->
<section>
  <h1>Context objects</h1>
    <pre class="danackCode spaceTop em1_4" data-trim><code class="php" data-trim>

class ArchiveContext {
    public $current;
    public $archive;
}

  </code>
</pre>

  
  <p>
    http://accu.org/index.php/journals/246
  </p>
  
  <aside class="notes">
    
    <p>A more powerful solution is to use context objects. These allow for 'contexts' to be re-used across your application, instead of having to have hacks everywhere.</p>
    
    <p>"The ability to bind the lifecycle and interactions of stateful components to well-defined but extensible lifecycle contexts."</p>
  
  </aside>
  
</section>

<!-- *************************** -->
<section>
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>
function createArchiveContext(DataStorageFactory $dsFactory) {
    return new ArchiveContext(
        $dsFactory->create('current');
        $dsFactory->create('archive');
    );
}

$injector->delegate('ArchiveContext', 'createArchiveContext');

// Want to move data from current to archive
function archiveData(ArchiveContext $archiveContext)
{
   $current = $archiveContext->current;
   $archive = $archiveContext->archive;
   ...
}

</code>
</pre>

  <aside class="notes">
    <p>
      
      
    </p>
  </aside>
  
</section>


<!-- *************************** -->
<section>
  <h1>Sometimes can't know dependencies</h1>
    <pre class="danackCode spaceTop em1_4" data-trim><code class="php" data-trim>

function sendMessage(UserPrefs $userPrefs, ...) 
{
    $service = $userPrefs->getMessageService();
    if ($service == 'twitter') {
        // Need a twitter Api
    }
    if ($service == 'pager_duty') {
        // Need a pager duty Api
    }
}

  </code>
</pre>

  <aside class="notes">
    <p></p>
  <p>
     This seems to be a problem that Symfony, Zend frameworks just don't want to recognise.
  </p>
  <p>
    I'm not entirely sure why, but I suspect it's just that they don't want people to know that there are limitations to those frameworks.
  </p> 
  <p>
    Symfony does abuse event handlers to solve this problem....some apps have 1600 event listeners registered, just in case they are needed.
  </p>

  
  </aside>
  
</section>


<!-- *************************** -->
<section>
    <pre class="danackCode spaceTop em0_9" data-trim><code class="php" data-trim>

function sendTwitterMessage(TwitterApi $twitterApi) {
   ...
}
      
function sendPagerDutyMessage(PagerDuty $pagerDuty) {
      
}
      
function sendMessage(UserPrefs $userPrefs) 
{
    $service = $userPrefs->getMessageService();
    if ($service == 'twitter') {
        return new Exec('sendTwitterMessage');
    }
    if ($service == 'pager_duty') {
        return new Exec('sendPagerDutyMessage');
    }
}

  </code>
</pre>

  <aside class="notes">
    <p></p>
  <p>
     This seems to be a problem that Symfony, Zend frameworks just don't want to recognise. I'm not entirely sure why, but I suspect it's just that they don't want people to know that there are limitations to those frameworks.
  </p>
  <p>
    
  </p> 
  <p>
    Basically the only solution that doesn't involve nasty hacks is to allow multiple levels of execution. I use this in my own 'framework'.
  </p>
  <p>
    Here, the 'sendMessage' routine doesn't actually send the message, it just looks up which callable to run next, and then tells the framework - Hey please run this next.
      
  </p>

  
  </aside>
  
</section>



<!-- *************************** -->
<section>
    <h2>Sometimes you do want to use a service locator</h2>
    <pre class="danackCode spaceTop em1" data-trim><code class="php" data-trim>

$injector->share($injector);

function createFoo(Injector $injector, Config $config)
{
    $apiVersion = $config->getApiVersion();

    if ($apiVersion == 1) {
        return $injector->make('ApiV1');
    }

    return $injector->make('ApiV2');
}
</code>
</pre>

  
  <aside class="notes">
    <p>
      And finally, sometimes doing dependency injection properly is just too much effort, and you think to yourself, what can one little service locator hurt.
    </p>

  </aside>
</section>



<!-- *************************** -->
<section class="em1_2">
  <h1 class="finale">Fin</h1>
  <div style="min-height: 100px">&nbsp;</div>
  <ul>
    <li>Push untestable code to the edges of your application.</li>
    <li>Push untyped code to the edges of your application.</li>
    <li>Use Auryn it is awesome.</li>
    <li>CLI app - https://github.com/Danack/console</li>
    <li>HTTP app - https://github.com/Danack/tier</li>    
    <li>Watch <a href="https://vimeo.com/80533536">https://vimeo.com/80533536</a></li>
    <li>https://joind.in/talk/88a21</li>
  </ul>
</section>


<!-- *************************** -->
<section style="width: 100%; text-align: center !important;">
    <img src="/images/true_neutral.jpg" />
</section>



<!-- *************************** -->
<section>
    <blockquote cite="http://searchservervirtualization.techtarget.com/definition/Our-Favorite-Technology-Quotations">
        &ldquo;For years there has been a theory that millions of monkeys typing at random on millions of typewriters would reproduce the entire works of Shakespeare. The Internet has proven this theory to be untrue.&rdquo;
    </blockquote>
</section>

        

<!-- *************************** -->
<section>
  <p>
    Object-oriented programming is an exceptionally bad idea which could only have originated in California — Edsger W. Dijkstra
  </p>

  <aside class="notes">
  </aside>  
</section>

        
        
        
      </div>
  </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>
            // Full list of configuration options available at:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: false,
                history: true,
                center: true,
                width: 1600,
                height: 900,

                // Factor of the display size that should remain empty around the content
                margin: 0.05,
                slideNumber: true,
                //transition: 'slide', // none/fade/slide/convex/concave/zoom
                transition: 'none', 
                //transitionSpeed: "slow",

                // Optional reveal.js plugins
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    //{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    //{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad({languages: ["php"]}); },  },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });
            
            
            /* This draws the graph on the slide on a slidechanged event */
            Reveal.addEventListener('slidechanged', function(event) {
                var callback = "render_"+event.currentSlide.id;
                if(typeof(window[callback])=="function") {
                    window[callback]();
                }
            } );
            /* This draws the graph if we got here directly without coming from another slide */
            Reveal.addEventListener('ready', function(event) {
                var callback = "render_"+event.currentSlide.id;
                if(typeof(window[callback])=="function") {
                    window[callback]();
                }
            });

var createFunc = function() {
  var counter = 0;
  var themeCounter = 0;
    return function(e) {
      
      
      var themeCSSList = [
        "css/theme/whiteDanack.css",
        "css/theme/beige.css",
        "css/theme/black.css",
        "css/theme/blood.css",
        "css/theme/league.css",
        "css/theme/moon.css",
        "css/theme/night.css",
        "css/theme/serif.css",
        "css/theme/simple.css",
        "css/theme/sky.css",
        "css/theme/solarized.css",
      ];
      
      var codeCSSList = [
        "lib/css/zenburn_backup.css",
        "lib/css/vsdanack.css",
      ];
      
      if(e.which == 67 || e.which == 99) { //'c'
        counter = (counter + 1);// % 1;

        var codestyle = codeCSSList[counter % codeCSSList.length];
        $("#codeststylecss").attr('href', codestyle);
        $("#debug").text(codestyle);
      }
    };
};

          $(window).keypress(createFunc());
        </script>
    </body>
</html>
